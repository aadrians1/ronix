;CKSUM.ASM	FEB-25-98
;Routine to calculate the checksum of instruction memory
; by Loren Blaney
;
	LIST	P=16C57		;closest PIC chip (has 2K)

	INCLUDE	"SXDEFS.INC"	;macro definitions for new instructions
DEVICE	EQU	PINS28+TURBO+SYNC+OPTIONX+STACKX+BANKS8+PAGES4+OSC4MHZ

;REGISTR DEFINITIONS
CHETCHIK_1	EQU	08H
CHETCHIK_2	EQU	09H
CHETCHIK_3	EQU	0AH
TEMP_LCD	EQU	0BH

;PIN DEFINITIONS
OUT_LED	EQU	0	;PORTC
RS	EQU	1	;PORTC
RD_WR	EQU	2	;PORTC
EN_LCD	EQU	3	;PORTC
DB4	EQU	4	;PORTC
DB5	EQU	5	;PORTC
DB6	EQU	6	;PORTC
DB7	EQU	7	;PORTC

	ORG	0
START	CALL	INITIAL		
NAZAD	CALL	PROGRAMMA	
	GOTO	NAZAD		

;----------------------------------------------------------------------
PROGRAMMA
	BSF	PORTC,OUT_LED
	CALL	SEKUNDA
	BCF	PORTC,OUT_LED
	CALL	SEKUNDA
	CLRF	TEMP_LCD
	BSF 	TEMP_LCD,RS
	BCF 	TEMP_LCD,RD_WR
	MOVLW	H'F0'
	ADDWF	TEMP_LCD,W
	MOVWF	PORTC
	CALL	CYCLE_LCD	
	CALL	CYCLE_LCD	
	BSF 	PORTC,RD_WR
	RETURN

INIT_LCD
	CALL	MS_15
	BSF	PORTC,DB4
	BSF	PORTC,DB5
	CALL	CYCLE_LCD	
	CALL	MS_5
	CALL	CYCLE_LCD	
	CALL	MKS_150
	CALL	CYCLE_LCD	

	BCF	PORTC,DB4
	CALL	CYCLE_LCD	
	CLRF	PORTC
	CALL	CYCLE_LCD	
	CALL	CYCLE_LCD	
	BSF	PORTC,DB7
	CALL	CYCLE_LCD	
	CLRF	PORTC
	CALL	CYCLE_LCD	
	BSF	PORTC,DB4
	CALL	CYCLE_LCD	
	CLRF	PORTC
	CALL	CYCLE_LCD	
	BSF	PORTC,DB6
	BSF	PORTC,DB5
	CALL	CYCLE_LCD	
	CLRF	PORTC
	BSF	PORTC,DB7
	CALL	CYCLE_LCD	
	CLRF	PORTC
	CALL	CYCLE_LCD	
	BSF	PORTC,RS
	RETURN
;###########################################################################
;
;	TIME MODULE
;
;###########################################################################
CYCLE_LCD
	NOP
	BSF	PORTC,EN_LCD
	NOP
	NOP
	BCF	PORTC,EN_LCD
	NOP
	RETURN

MKS_150
	MOVLW	H'80'
	MOVWF	CHETCHIK_1
LOOP1	NOP
	DECFSZ	CHETCHIK_1,F
	GOTO	LOOP1	
	RETURN

MS_15
	MOVLW	D'100'
	MOVWF	CHETCHIK_2
LOOP2	CALL	MKS_150
	DECFSZ	CHETCHIK_2,F
	GOTO	LOOP2	
	RETURN

MS_5
	MOVLW	D'30'
	MOVWF	CHETCHIK_3
LOOP3	CALL	MKS_150
	DECFSZ	CHETCHIK_3,F
	GOTO	LOOP3	
	RETURN

SEKUNDA
	MOVLW	D'200'
	MOVWF	CHETCHIK_2
LOOP4	CALL	MS_5
	DECFSZ	CHETCHIK_2,F
	GOTO	LOOP4	
	RETURN
;###########################################################################
;	END TIME MODULE
;###########################################################################


INITIAL		
	MOVLW	B'00001111'
	TRIS	PORTA
	MOVLW	B'00000000'
	TRIS 	PORTC
	CLRF	PORTC
	CLRF	TEMP_LCD
	MOVLW	H'0E'
	MOVWM
	MOVLW	H'FF'
	MOVWF	!PORTC	
	CALL	INIT_LCD
	RETURN


	ORG	07FFh		;reset vector

	END
